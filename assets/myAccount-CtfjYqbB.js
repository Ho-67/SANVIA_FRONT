import{v as M}from"./index-Db4s8cux.js";import{X as ue,Y as ce,Z as $,$ as me,a0 as ve,g as T,a1 as fe,a2 as j,a3 as ge,a4 as pe,a5 as xe,a6 as q,v as a,a7 as O,a8 as be,b as l,f as H,n as J,a9 as ye,aa as Ve,E as he,ab as ke,ac as te,F as _e,ad as we,u as Ce,H as Se,h as K,ae as Q,i as Pe,J as Te,K as Ae,L as z,N as D,w as Ie,c as Be,m as Fe,a as Ue,s as t,B as f,V as R,o as W,af as Ee,P as X,C as L,D as P,y as C,Q as Y,x as g,ag as ze,ah as De,t as p,T as Z,U as Re}from"./index-Cy3rsmT0.js";import{V as G,m as Le}from"./VCheckboxBtn-UyNAd-A7.js";import{V as Ne}from"./VTextarea-BUJIg8dx.js";import{V as ee}from"./VSelect-CSisNt0d.js";import"./VChip-yjxMPXwl.js";const Me=ce({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...be(),...Le()},"VSwitch"),ae=ue()({name:"VSwitch",inheritAttrs:!1,props:Me(),emits:{"update:focused":s=>!0,"update:modelValue":s=>!0,"update:indeterminate":s=>!0},setup(s,n){let{attrs:k,slots:r}=n;const x=$(s,"indeterminate"),m=$(s,"modelValue"),{loaderClasses:_}=me(s),{isFocused:c,focus:A,blur:h}=ve(s),S=T(),v=fe&&window.matchMedia("(forced-colors: active)").matches,b=j(()=>typeof s.loading=="string"&&s.loading!==""?s.loading:s.color),V=ge(),I=j(()=>s.id||`switch-${V}`);function i(){x.value&&(x.value=!1)}function e(o){var d,u;o.stopPropagation(),o.preventDefault(),(u=(d=S.value)==null?void 0:d.input)==null||u.click()}return pe(()=>{const[o,d]=xe(k),u=q.filterProps(s),le=G.filterProps(s);return a(q,O({class:["v-switch",{"v-switch--flat":s.flat},{"v-switch--inset":s.inset},{"v-switch--indeterminate":x.value},_.value,s.class]},o,u,{modelValue:m.value,"onUpdate:modelValue":B=>m.value=B,id:I.value,focused:c.value,style:s.style}),{...r,default:B=>{let{id:se,messagesId:oe,isDisabled:ie,isReadonly:ne,isValid:N}=B;const F={model:m,isValid:N};return a(G,O({ref:S},le,{modelValue:m.value,"onUpdate:modelValue":[w=>m.value=w,i],id:se.value,"aria-describedby":oe.value,type:"checkbox","aria-checked":x.value?"mixed":void 0,disabled:ie.value,readonly:ne.value,onFocus:A,onBlur:h},d),{...r,default:w=>{let{backgroundColorClasses:U,backgroundColorStyles:y}=w;return l("div",{class:J(["v-switch__track",v?void 0:U.value]),style:H(y.value),onClick:e},[r["track-true"]&&l("div",{key:"prepend",class:"v-switch__track-true"},[r["track-true"](F)]),r["track-false"]&&l("div",{key:"append",class:"v-switch__track-false"},[r["track-false"](F)])])},input:w=>{let{inputNode:U,icon:y,backgroundColorClasses:re,backgroundColorStyles:de}=w;return l(_e,null,[U,l("div",{class:J(["v-switch__thumb",{"v-switch__thumb--filled":y||s.loading},s.inset||v?void 0:re.value]),style:H(s.inset?void 0:de.value)},[r.thumb?a(ye,{defaults:{VIcon:{icon:y,size:"x-small"}}},{default:()=>[r.thumb({...F,icon:y})]}):a(Ve,null,{default:()=>[s.loading?a(ke,{name:"v-switch",active:!0,color:N.value===!1?void 0:b.value},{default:E=>r.loader?r.loader(E):a(te,{active:E.isActive,color:E.color,indeterminate:!0,size:"16",width:"2"},null)}):y&&a(he,{key:String(y),icon:y,size:"x-small"},null)]})])])}})}})}),{}}}),$e={class:"d-flex flex-column pa-6 overflow-y-auto text-text"},je={class:"d-flex align-center flex-wrap-nowrap mb-2"},qe={class:"d-flex align-center flex-wrap-nowrap"},Oe={class:"pa-4"},He={class:"text-h5 font-weight-bold"},Je={class:"text-h5 font-weight-bold"},Ke={class:"text-h5 font-weight-bold"},Qe={class:"text-h5 font-weight-bold"},We={class:"d-flex align-center mb-2"},Xe={class:"d-flex align-center mb-2"},la={__name:"myAccount",setup(s){const n=we(),k=Ce(),r=Se(),x=K({get:()=>n.theme==="dark",set:async i=>{const e=i?"dark":"light";n.theme!==e&&(await n.setTheme(e),k.global.name.value=e)}}),m=K({get:()=>n.role==="seller",set:async i=>{var o,d;const e=i?"seller":"buyer";if(n.role!==e)try{const u=await Q.apiAuth.patch("/user/profile",{role:e});if(u.data.success)await n.setRole(e);else throw new Error(u.data.message||"身分切換失敗")}catch(u){console.error(u),r({text:((d=(o=u==null?void 0:u.response)==null?void 0:o.data)==null?void 0:d.message)||"身分切換失敗，請稍後再試！",snackbarProps:{color:"error"}})}}}),_=T(!0),c=T(!1),A=()=>{c.value&&(v.value.value=n.account,b.value.value=n.email,V.value.value=n.bio),c.value=!c.value},h=T({emotions:"100",resonances:"35",dailyTask:"5",messages:"2"});Pe(async()=>{_.value=!0;try{await n.fetchUser()||r({text:"無法取得用戶資料，請重新登入",snackbarProps:{color:"error"}})}catch(i){console.error("Failed to fetch user data:",i),r({text:"取得用戶資料時發生錯誤",snackbarProps:{color:"red"}})}finally{_.value=!1}});const S=Te({validationSchema:Ae({account:z().required("帳號必填").min(4,"帳號至少4個字").max(20,"帳號最多20個字").test("isAlphanumeric","帳號只能包含英文字母和數字",i=>M.isAlphanumeric(i||"")),email:z().required("信箱必填").test("isEmail","請輸入有效的信箱",i=>M.isEmail(i||"")),bio:z()})}),v=D("account"),b=D("email"),V=D("bio");Ie(()=>({account:n.account,email:n.email,bio:n.bio,theme:n.theme,isLoggedIn:n.isLoggedIn,isSeller:n.isSeller}),i=>{i.isLoggedIn&&!c.value&&(v.value.value=i.account||"",b.value.value=i.email||"",V.value.value=i.bio||""),i.theme&&k.global.name.value!==i.theme&&(k.global.name.value=i.theme)},{immediate:!0,deep:!0});async function I(){var e,o;if(!(await S.validate()).valid){r({text:"請修正表單錯誤",snackbarProps:{color:"red"}});return}try{const d={account:v.value.value,email:b.value.value,bio:V.value.value,theme:x.value?"dark":"light",role:m.value?"seller":"buyer"},u=await Q.apiAuth.patch("/user/profile",d);if(u.data.success)n.setAccountInfo(d),c.value=!1,r({text:"儲存成功！",snackbarProps:{color:"green"}});else throw new Error(u.data.message||"儲存失敗")}catch(d){console.error(d),r({text:((o=(e=d==null?void 0:d.response)==null?void 0:e.data)==null?void 0:o.message)||"儲存失敗，請稍後再試！",snackbarProps:{color:"red"}})}}return(i,e)=>(W(),Be("div",$e,[a(f,{class:"mb-6 pa-4"},{default:t(()=>[a(Ee,{class:"align-center justify-center","model-value":_.value},{default:t(()=>[a(te,{indeterminate:""})]),_:1},8,["model-value"]),a(X,{class:"d-flex justify-space-between align-center"},{default:t(()=>[e[5]||(e[5]=l("span",null,"基本資料",-1)),a(L,{color:"primary",flat:"",size:"small",onClick:A},{default:t(()=>[P(C(c.value?"取消":"編輯"),1)]),_:1})]),_:1,__:[5]}),a(Y,null,{default:t(()=>[a(R,{class:"d-flex align-center","no-gutters":""},{default:t(()=>[a(g,{class:"d-flex flex-column align-center pa-4",cols:"12",md:"2"},{default:t(()=>[a(ze,{size:"96"},{default:t(()=>{var o;return[a(De,{src:((o=p(n).user)==null?void 0:o.avatar)||"https://picsum.photos/200/200/?random=10"},null,8,["src"])]}),_:1}),a(L,{class:"mt-2",color:"primary",density:"compact",size:"small"},{default:t(()=>e[6]||(e[6]=[P(" 編輯頭像 ")])),_:1,__:[6]})]),_:1}),a(g,{class:"px-4 pb-4 pt-10",cols:"12",md:"6"},{default:t(()=>[a(Z,{modelValue:p(v).value.value,"onUpdate:modelValue":e[0]||(e[0]=o=>p(v).value.value=o),class:"text-subtitle-1",density:"comfortable","error-messages":p(v).errorMessage.value,"hide-details":"auto",label:"帳戶",readonly:!c.value,variant:"outlined"},null,8,["modelValue","error-messages","readonly"]),a(Z,{modelValue:p(b).value.value,"onUpdate:modelValue":e[1]||(e[1]=o=>p(b).value.value=o),class:"text-subtitle-1 mt-4",density:"comfortable","error-messages":p(b).errorMessage.value,"hide-details":"auto",label:"信箱",readonly:!c.value,variant:"outlined"},null,8,["modelValue","error-messages","readonly"])]),_:1}),a(g,{class:"pa-4",cols:"12",md:"4"},{default:t(()=>[a(f,{class:"pa-4",variant:"outlined"},{default:t(()=>[l("div",je,[e[7]||(e[7]=l("span",{class:"text-subtitle-1 text-grey-darken-1 me-4"},"當前身分",-1)),e[8]||(e[8]=l("span",{class:"text-subtitle-1 text-grey-darken-1"},"買家",-1)),a(ae,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=o=>m.value=o),class:"mx-2",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"]),e[9]||(e[9]=l("span",{class:"text-subtitle-1 text-grey-darken-1"},"賣家",-1))]),l("div",qe,[e[10]||(e[10]=l("span",{class:"text-subtitle-1 text-grey-darken-1 me-4"},"當前主題",-1)),e[11]||(e[11]=l("span",{class:"text-subtitle-1 text-grey-darken-1"},"明",-1)),a(ae,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=o=>x.value=o),class:"mx-2",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"]),e[12]||(e[12]=l("span",{class:"text-subtitle-1 text-grey-darken-1"},"暗",-1))])]),_:1})]),_:1})]),_:1}),l("div",Oe,[a(Ne,{modelValue:p(V).value.value,"onUpdate:modelValue":e[4]||(e[4]=o=>p(V).value.value=o),label:"個人介紹",readonly:!c.value,variant:"outlined"},null,8,["modelValue","readonly"])])]),_:1}),a(Re,{class:"justify-end"},{default:t(()=>[a(L,{color:"primary",disabled:!c.value,onClick:I},{default:t(()=>e[13]||(e[13]=[P("儲存")])),_:1,__:[13]},8,["disabled"])]),_:1})]),_:1}),a(R,null,{default:t(()=>[a(g,{cols:"12",md:"3",sm:"6"},{default:t(()=>[a(f,{class:"pa-4 text-center"},{default:t(()=>[l("div",He,C(h.value.emotions),1),e[14]||(e[14]=l("div",{class:"text-subtitle-1 text-grey"},"當前情緒幣",-1))]),_:1,__:[14]})]),_:1}),a(g,{cols:"12",md:"3",sm:"6"},{default:t(()=>[a(f,{class:"pa-4 text-center"},{default:t(()=>[l("div",Je,C(h.value.resonances),1),e[15]||(e[15]=l("div",{class:"text-subtitle-1 text-grey"},"個人頁面",-1))]),_:1,__:[15]})]),_:1}),a(g,{cols:"12",md:"3",sm:"6"},{default:t(()=>[a(f,{class:"pa-4 text-center"},{default:t(()=>[l("div",Ke,C(h.value.dailyTask),1),e[16]||(e[16]=l("div",{class:"text-subtitle-1 text-grey"},"每日任務",-1))]),_:1,__:[16]})]),_:1}),a(g,{cols:"12",md:"3",sm:"6"},{default:t(()=>[a(f,{class:"pa-4 text-center"},{default:t(()=>[l("div",Qe,C(h.value.messages),1),e[17]||(e[17]=l("div",{class:"text-subtitle-1 text-grey"},"聊天通知",-1))]),_:1,__:[17]})]),_:1})]),_:1}),m.value?(W(),Fe(f,{key:0,class:"mt-6 pa-4"},{default:t(()=>[a(X,{class:"mb-4"},{default:t(()=>e[18]||(e[18]=[P("數據分析")])),_:1,__:[18]}),a(Y,null,{default:t(()=>[a(R,null,{default:t(()=>[a(g,{cols:"12",md:"6"},{default:t(()=>[a(f,{class:"pa-4",variant:"outlined"},{default:t(()=>[l("div",We,[e[19]||(e[19]=l("div",{class:"text-h6 me-4"},"總收益",-1)),a(ee,{density:"compact","hide-details":"",items:["圖表","明細"],label:"切換顯示內容",variant:"outlined"})]),e[20]||(e[20]=l("div",{class:"bg-grey-lighten-2 rounded",style:{height:"250px"}},null,-1))]),_:1,__:[20]})]),_:1}),a(g,{cols:"12",md:"6"},{default:t(()=>[a(f,{class:"pa-4",variant:"outlined"},{default:t(()=>[l("div",Xe,[e[21]||(e[21]=l("div",{class:"text-h6 me-4"},"商品收益",-1)),a(ee,{density:"compact","hide-details":"",items:["商品一","商品二","商品三"],label:"選擇商品分析",variant:"outlined"})]),e[22]||(e[22]=l("div",{class:"bg-grey-lighten-2 rounded",style:{height:"250px"}},null,-1))]),_:1,__:[22]})]),_:1})]),_:1})]),_:1})]),_:1})):Ue("",!0)]))}};export{la as default};
