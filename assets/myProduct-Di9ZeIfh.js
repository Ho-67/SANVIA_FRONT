import{h as K,N as Fe,g as $,O as Ee,P as ie,bf as Ve,bg as re,Q as R,bh as Me,S as P,q as de,w as X,aN as Ne,p as O,o as b,t,v as e,X as Te,Y as Le,x as u,C as Ie,U as je,G as U,D as B,W as $e,V as H,y as c,Z as J,b as p,c as T,a as _e,E as h,aI as oe,F as se,e as ce,n as be,$ as Re,aT as qe,_ as Ce,H as N,bi as ke,ac as xe,k as ze,A as Be,B as He,am as Se}from"./index-BtFLwgLr.js";import{V as te}from"./VSelect-D7eXUuJ2.js";import{V as Je}from"./VTextarea-BiPjLmWG.js";import{V as De}from"./VCheckbox-CtU06HRw.js";import{V as Ue,a as Ke}from"./VDatePicker-Cbzfh64P.js";import{V as We}from"./VTooltip-BRauXJ5O.js";import"./VCheckboxBtn-Dvh_Yx-E.js";import"./VChip-DpCIU4eF.js";import"./VPagination-Zd8pgTfx.js";import"./VTable-BAbXA3Xw.js";const D=[];for(let i=0;i<256;++i)D.push((i+256).toString(16).slice(1));function Ge(i,f=0){return(D[i[f+0]]+D[i[f+1]]+D[i[f+2]]+D[i[f+3]]+"-"+D[i[f+4]]+D[i[f+5]]+"-"+D[i[f+6]]+D[i[f+7]]+"-"+D[i[f+8]]+D[i[f+9]]+"-"+D[i[f+10]]+D[i[f+11]]+D[i[f+12]]+D[i[f+13]]+D[i[f+14]]+D[i[f+15]]).toLowerCase()}let ue;const Qe=new Uint8Array(16);function Xe(){if(!ue){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ue=crypto.getRandomValues.bind(crypto)}return ue(Qe)}const Ye=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),we={randomUUID:Ye};function ae(i,f,V){var C;if(we.randomUUID&&!i)return we.randomUUID();i=i||{};const w=i.random??((C=i.rng)==null?void 0:C.call(i))??Xe();if(w.length<16)throw new Error("Random bytes length must be >= 16");return w[6]=w[6]&15|64,w[8]=w[8]&63|128,Ge(w)}const Ze={class:"d-flex align-center"},el={key:0,class:"text-accent text-error ml-2"},ll={class:"d-flex align-center"},tl={key:0,class:"text-accent text-error ml-2"},al={__name:"productAddDialog",props:{modelValue:{type:Boolean,required:!0},product:{type:Object,default:null}},emits:["update:modelValue","submitSuccess"],setup(i,{emit:f}){const V=i,w=f,C=K({get:()=>V.modelValue,set:r=>w("update:modelValue",r)}),F=K(()=>!!V.product),x=Fe(),I=$(null),k=$([]),y=$({}),E=["正面","中立","負面","其他"],M=["文字","圖片","音樂","語音","影片","物品","其他"],{handleSubmit:G,resetForm:W,isSubmitting:q}=Ee({validationSchema:ie({name:R().required("商品名稱必填").max(50,"商品名稱最多50個字"),price:Me().typeError("情緒價值必填").required("情緒價值必填").min(0,"情緒價值不得為負數"),emotions:R().required("情緒分類必填").oneOf(E,"請選擇有效的分類"),category:R().required("商品類別必填").oneOf(M,"請選擇有效的分類"),details:R().max(20,"細項說明最多20字"),description:R().required("商品簡介必填").max(200,"商品簡介最多200字"),images:re().min(1,"至少需要一張商品圖片").max(5,"最多只能上傳5張圖片").required("至少需要一張商品圖片"),features:re().of(ie({type:R().oneOf(["文字說明","圖片說明","影音說明"]),content:R()})),specifications:re().of(ie({type:R().oneOf(["文字說明","圖片說明"]),content:R()})),sell:Ve().required(),roll:Ve().required()}),initialValues:{name:"",price:0,emotions:"",category:"",details:"",description:"",sell:!1,features:[],specifications:[],roll:!1,images:[]}}),L=P("name"),d=P("price"),s=P("emotions"),o=P("category"),n=P("details"),S=P("description"),A=P("features"),j=P("specifications"),Y=P("sell"),Z=P("roll"),Ae=P("images"),me=()=>{C.value=!1},Pe=r=>{k.value=r,Ae.value.value=r},pe=K(()=>(A.value.value||[]).length>=10),fe=K(()=>(j.value.value||[]).length>=5),ve=r=>{if(r==="features"){if(Array.isArray(A.value.value)||(A.value.value=[]),A.value.value.length>=10){x({text:"商品特色最多只能新增 10 個",snackbarProps:{color:"red"}});return}A.value.value.push({type:"文字說明",content:"",tempId:ae()})}else if(r==="specifications"){if(!Array.isArray(j.value.value))j.value.value=[];else if(j.value.value.length>=5){x({text:"商品規格最多只能新增 5 個",snackbarProps:{color:"red"}});return}j.value.value.push({type:"文字說明",content:"",tempId:ae()})}},ge=(r,a)=>{const _=r==="features"?A.value.value:j.value.value,l=_[a];if(l&&l.tempId){const v=r==="features"?`feature${l.tempId}`:`spec${l.tempId}`;y.value[v]&&delete y.value[v]}_.splice(a,1)},ye=(r,a,_)=>{const l=`${a}${r.tempId}`;_&&_.length>0?_.some(g=>g.file instanceof File)?(y.value[l]=_,r.content="__HAS_FILE__"):_[0].source&&(r.content=_[0].source):(delete y.value[l],r.content="")},Oe=G(async r=>{var a,_;if(!F.value&&k.value.length===0){x({text:"請至少上傳一張商品圖片",snackbarProps:{color:"red"}});return}for(const l of[...r.features,...r.specifications])if(l.type!=="文字說明"&&!l.content){x({text:"圖片或影音內容不能為空",snackbarProps:{color:"red"}});return}try{const l=new FormData;if(l.append("emotions",r.emotions),l.append("category",r.category),l.append("details",r.details),l.append("name",r.name),l.append("price",r.price),l.append("description",r.description),l.append("sell",r.sell),l.append("roll",r.roll),F.value){const m=k.value.filter(z=>typeof z.source=="string"&&!(z.file instanceof File)).map(z=>z.source);l.append("existingImages",JSON.stringify(m))}const v=k.value.filter(m=>m.file instanceof File);for(const m of v)l.append("images",m.file);const g=[],ee=[],le=[];for(const m of r.features)if(m.type==="文字說明")ee.push(m);else{const z=`feature${m.tempId}`,Q=(y.value[z]||[]).find(ne=>ne.file instanceof File);Q?(g.push(Q.file),ee.push({type:m.type,content:"__HAS_FILE__"})):m.content&&m.content!=="__HAS_FILE__"&&ee.push({type:m.type,content:m.content})}for(const m of r.specifications)if(m.type==="文字說明")le.push(m);else{const z=`spec${m.tempId}`,Q=(y.value[z]||[]).find(ne=>ne.file instanceof File);Q?(g.push(Q.file),le.push({type:m.type,content:"__HAS_FILE__"})):m.content&&m.content!=="__HAS_FILE__"&&le.push({type:m.type,content:m.content})}for(const m of g)l.append("dynamicMedia",m);l.append("features",JSON.stringify(ee)),l.append("specifications",JSON.stringify(le)),await(F.value?de.update(V.product._id,l):de.create(l)),x({text:"操作成功！",snackbarProps:{color:"green"}}),me(),w("submitSuccess")}catch(l){console.error("Error submitting form:",l),x({text:((_=(a=l.response)==null?void 0:a.data)==null?void 0:_.message)||"操作失敗，請稍後再試",snackbarProps:{color:"red"}})}});return X(()=>C.value,r=>{var a;if(r)if(F.value){L.value.value=V.product.name,d.value.value=V.product.price,s.value.value=V.product.emotions,o.value.value=V.product.category,n.value.value=V.product.details,S.value.value=V.product.description,Y.value.value=V.product.sell,Z.value.value=V.product.roll||!1,A.value.value=V.product.features?JSON.parse(JSON.stringify(V.product.features)):[],j.value.value=V.product.specifications?JSON.parse(JSON.stringify(V.product.specifications)):[],k.value=((a=V.product.images)==null?void 0:a.map(_=>({source:_.replaceAll("\\","/"),options:{type:"local",file:{name:_.split("/").pop(),size:0,type:"image/jpeg, image/png, image/gif"}}})))||[],y.value={};for(const[_,l]of A.value.value.entries())if(l.type!=="文字說明"&&l.content){const v=ae();l.tempId=v;const g=`feature${v}`;y.value[g]=[{source:l.content,options:{type:"local"}}],l.content="__HAS_FILE__"}for(const[_,l]of j.value.value.entries())if(l.type==="圖片說明"&&l.content){const v=ae();l.tempId=v;const g=`spec${v}`;y.value[g]=[{source:l.content,options:{type:"local"}}],l.content="__HAS_FILE__"}}else W(),k.value=[],y.value={}},{immediate:!0}),(r,a)=>{const _=Ne("FilePond");return b(),O(qe,{modelValue:C.value,"onUpdate:modelValue":a[11]||(a[11]=l=>C.value=l),fullscreen:"",transition:"dialog-bottom-transition"},{default:t(()=>[e(Te,{class:"h-100",disabled:u(q),onSubmit:Le(u(Oe),["prevent"])},{default:t(()=>[e(Ie,null,{default:t(()=>[e(je,{class:"text-accent px-6 mt-4"},{default:t(()=>[U(B(F.value?"編輯商品":"新增商品"),1)]),_:1}),e($e,null,{default:t(()=>[e(H,{"no-gutters":""},{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(J,{modelValue:u(L).value.value,"onUpdate:modelValue":a[0]||(a[0]=l=>u(L).value.value=l),class:"mb-4 pr-md-1","error-messages":u(L).errorMessage.value,label:"商品名稱",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(J,{modelValue:u(d).value.value,"onUpdate:modelValue":a[1]||(a[1]=l=>u(d).value.value=l),modelModifiers:{number:!0},class:"mb-4 pl-md-1","error-messages":u(d).errorMessage.value,label:"情緒價值",min:"0",type:"number",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(te,{modelValue:u(s).value.value,"onUpdate:modelValue":a[2]||(a[2]=l=>u(s).value.value=l),class:"mb-4 pr-md-1","error-messages":u(s).errorMessage.value,items:E,label:"情緒分類",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(te,{modelValue:u(o).value.value,"onUpdate:modelValue":a[3]||(a[3]=l=>u(o).value.value=l),class:"mb-4 px-md-1","error-messages":u(o).errorMessage.value,items:M,label:"商品類別",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(c,{cols:"12",md:"4"},{default:t(()=>[e(J,{modelValue:u(n).value.value,"onUpdate:modelValue":a[4]||(a[4]=l=>u(n).value.value=l),class:"mb-4 pl-md-1","error-messages":u(n).errorMessage.value,label:"細項說明(選填)",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(c,{class:"my-4",cols:"12"},{default:t(()=>[e(H,null,{default:t(()=>[e(c,{cols:"12",sm:"auto"},{default:t(()=>a[12]||(a[12]=[p("span",{class:"text-body-1 text-nav mb-0"},"上傳商品圖",-1),p("br",null,null,-1),p("span",{class:"text-body-2 text-nav mb-0"},"（最多5張）",-1)])),_:1,__:[12]}),e(c,null,{default:t(()=>[e(_,{ref_key:"fileAgent",ref:I,modelValue:k.value,"onUpdate:modelValue":a[5]||(a[5]=l=>k.value=l),"accepted-file-types":"image/jpeg, image/png, image/gif","allow-multiple":!0,credits:"",files:k.value,"label-idle":"拖曳或點選 上傳圖片（第一張為封面圖）","label-max-file-size":"最大允許大小：{filesize}","max-file-size":"1MB","max-files":5,onUpdatefiles:Pe},null,8,["modelValue","files"])]),_:1})]),_:1})]),_:1}),e(c,{class:"mt-4",cols:"12"},{default:t(()=>[e(Je,{modelValue:u(S).value.value,"onUpdate:modelValue":a[6]||(a[6]=l=>u(S).value.value=l),class:"mb-4","error-messages":u(S).errorMessage.value,label:"商品描述(簡介)",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(c,{class:"my-4",cols:"12"},{default:t(()=>[p("div",Ze,[a[14]||(a[14]=p("span",{class:"text-body-1 text-nav mb-0"},"商品特色(主要內容)",-1)),e(h,{class:"ml-auto",color:"primary",density:"compact",disabled:pe.value,variant:"outlined",onClick:a[7]||(a[7]=l=>ve("features"))},{default:t(()=>a[13]||(a[13]=[U(" 新增特色 ")])),_:1,__:[13]},8,["disabled"]),pe.value?(b(),T("p",el,"最多新增 10 個")):_e("",!0)]),e(oe,{class:"my-2"}),(b(!0),T(se,null,ce(u(A).value.value,(l,v)=>(b(),T("div",{key:v},[e(H,{class:"mt-2","no-gutters":""},{default:t(()=>[e(c,{cols:"12",md:"4"},{default:t(()=>[e(te,{modelValue:l.type,"onUpdate:modelValue":g=>l.type=g,density:"compact","hide-details":"",items:["文字說明","圖片說明","影音說明"],label:"內容類型",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{cols:"12",md:"8"},{default:t(()=>[l.type==="文字說明"?(b(),O(J,{key:0,modelValue:l.content,"onUpdate:modelValue":g=>l.content=g,class:"pl-md-2",density:"compact","hide-details":"",label:"內容 "+(v+1),variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","label"])):(b(),O(_,{key:1,id:"featurePond"+v,ref_for:!0,ref:"featurePond"+v,"accepted-file-types":l.type==="圖片說明"?"image/jpeg, image/png, image/gif":"audio/mpeg, audio/wav, video/mp4","allow-multiple":!0,class:be("pl-md-2"),credits:"",files:y.value["feature"+l.tempId],"label-idle":"拖曳或點選 上傳 "+(l.type==="圖片說明"?"圖片說明":"影音說明"),"max-file-size":"20MB",onUpdatefiles:g=>ye(l,"feature",g)},null,8,["id","accepted-file-types","files","label-idle","onUpdatefiles"]))]),_:2},1024),e(c,{class:"d-flex justify-end mt-2",cols:"12"},{default:t(()=>[e(h,{color:"red",density:"compact",variant:"text",onClick:g=>ge("features",v)},{default:t(()=>a[15]||(a[15]=[U(" 刪除 ")])),_:2,__:[15]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),_:1}),e(c,{class:"my-4",cols:"12"},{default:t(()=>[p("div",ll,[a[17]||(a[17]=p("span",{class:"text-body-1 text-nav mb-0"},"商品規格",-1)),e(h,{class:"ml-auto",color:"primary",density:"compact",disabled:fe.value,variant:"outlined",onClick:a[8]||(a[8]=l=>ve("specifications"))},{default:t(()=>a[16]||(a[16]=[U(" 新增規格 ")])),_:1,__:[16]},8,["disabled"]),fe.value?(b(),T("p",tl,"最多新增 5 個")):_e("",!0)]),e(oe,{class:"my-2"}),(b(!0),T(se,null,ce(u(j).value.value,(l,v)=>(b(),T("div",{key:v},[e(H,{class:"mt-2","no-gutters":""},{default:t(()=>[e(c,{cols:"12",md:"4"},{default:t(()=>[e(te,{modelValue:l.type,"onUpdate:modelValue":g=>l.type=g,density:"compact","hide-details":"",items:["文字說明","圖片說明"],label:"內容類型",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,{cols:"12",md:"8"},{default:t(()=>[l.type==="文字說明"?(b(),O(J,{key:0,modelValue:l.content,"onUpdate:modelValue":g=>l.content=g,class:"pl-md-2",density:"compact","hide-details":"",label:"內容 "+(v+1),variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","label"])):(b(),O(_,{key:1,id:"specPond"+v,ref_for:!0,ref:"specPond"+v,"accepted-file-types":"image/jpeg, image/png, image/gif","allow-multiple":!0,class:be("pl-md-2"),credits:"",files:y.value["spec"+l.tempId],"label-idle":"拖曳或點選 上傳 圖片","max-file-size":"20MB",onUpdatefiles:g=>ye(l,"spec",g)},null,8,["id","files","onUpdatefiles"]))]),_:2},1024),e(c,{class:"d-flex justify-end mt-2",cols:"12"},{default:t(()=>[e(h,{color:"red",density:"compact",variant:"text",onClick:g=>ge("specifications",v)},{default:t(()=>a[18]||(a[18]=[U(" 刪除 ")])),_:2,__:[18]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1})]),_:1}),e(Re,null,{default:t(()=>[e(H,{class:"px-3","no-gutters":""},{default:t(()=>[e(c,{class:"d-flex no-wrap",cols:"12",sm:"6"},{default:t(()=>[e(De,{modelValue:u(Y).value.value,"onUpdate:modelValue":a[9]||(a[9]=l=>u(Y).value.value=l),"error-messages":u(Y).errorMessage.value,"hide-details":"",label:"上架"},null,8,["modelValue","error-messages"]),e(De,{modelValue:u(Z).value.value,"onUpdate:modelValue":a[10]||(a[10]=l=>u(Z).value.value=l),"error-messages":u(Z).errorMessage.value,"hide-details":"",label:"開放骰點交易"},null,8,["modelValue","error-messages"])]),_:1}),e(c,{class:"d-flex justify-end pt-1",cols:"12",sm:"6"},{default:t(()=>[e(h,{class:"text-primary",disabled:u(q),onClick:me},{default:t(()=>a[19]||(a[19]=[U(" 取消 ")])),_:1,__:[19]},8,["disabled"]),e(h,{class:"text-accent",loading:u(q),type:"submit",variant:"flat"},{default:t(()=>[U(B(F.value?"編輯":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])}}},ol={class:"sticky-top"},sl={class:"d-flex align-center"},nl={__name:"productTop",props:{search:{type:String,default:""}},emits:["update:search","openDialog","resetFilters","search"],setup(i,{emit:f}){const V=i,w=f,C=$(!1),F=$(!1),x=$(null),I=$(null),k=$(V.search),y=$(null),E=$(null);X(x,o=>{y.value=o},{immediate:!0}),X(I,o=>{E.value=o},{immediate:!0});const M=K(()=>x.value&&I.value&&new Date(x.value)>new Date(I.value)?["開始日期不能晚於結束日期"]:[]),G=o=>{x.value=o,C.value=!1,s()},W=o=>{I.value=o,F.value=!1,s()};X(()=>k.value,()=>s()),X(()=>[x.value,I.value],()=>s());const q=K(()=>x.value?new Date(x.value).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):""),L=K(()=>I.value?new Date(I.value).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):""),d=()=>{x.value=null,I.value=null,k.value="",w("resetFilters")},s=()=>{M.value.length>0||w("search",{search:k.value,startDate:x.value?new Date(x.value):null,endDate:I.value?new Date(I.value):null})};return(o,n)=>(b(),T("div",ol,[e(H,{"no-gutters":""},{default:t(()=>[e(c,{class:"pa-4",cols:"12",lg:"2",md:"3"},{default:t(()=>[e(h,{block:"",color:"primary",variant:"outlined",onClick:n[0]||(n[0]=S=>o.$emit("openDialog",null))},{default:t(()=>[e(N,{left:""},{default:t(()=>n[8]||(n[8]=[U("mdi-plus")])),_:1,__:[8]}),n[9]||(n[9]=U(" 新增商品 "))]),_:1,__:[9]})]),_:1}),e(c,{class:"pa-4",cols:"12",lg:"5",md:"9"},{default:t(()=>[p("div",sl,[e(ke,{modelValue:C.value,"onUpdate:modelValue":n[3]||(n[3]=S=>C.value=S),"close-on-content-click":!1,location:"bottom left",transition:"scale-transition"},{activator:t(({props:S})=>[e(J,xe({modelValue:q.value,"onUpdate:modelValue":n[1]||(n[1]=A=>q.value=A),density:"compact"},S,{"error-messages":M.value,"hide-details":"",label:"開始日期","prepend-inner-icon":"mdi-calendar",readonly:"",variant:"outlined"}),null,16,["modelValue","error-messages"])]),default:t(()=>[e(Ue,{modelValue:y.value,"onUpdate:modelValue":[n[2]||(n[2]=S=>y.value=S),G],"first-day-of-week":1,max:E.value},null,8,["modelValue","max"])]),_:1},8,["modelValue"]),n[10]||(n[10]=p("span",{class:"mx-2"},"~",-1)),e(ke,{modelValue:F.value,"onUpdate:modelValue":n[6]||(n[6]=S=>F.value=S),"close-on-content-click":!1,location:"bottom left",transition:"scale-transition"},{activator:t(({props:S})=>[e(J,xe({modelValue:L.value,"onUpdate:modelValue":n[4]||(n[4]=A=>L.value=A),density:"compact"},S,{"error-messages":M.value,"hide-details":"",label:"結束日期","prepend-inner-icon":"mdi-calendar",readonly:"",variant:"outlined"}),null,16,["modelValue","error-messages"])]),default:t(()=>[e(Ue,{modelValue:E.value,"onUpdate:modelValue":[n[5]||(n[5]=S=>E.value=S),W],"first-day-of-week":1,min:y.value},null,8,["modelValue","min"])]),_:1},8,["modelValue"])])]),_:1}),e(c,{class:"pa-4",cols:"6",lg:"3",md:"9",sm:"8"},{default:t(()=>[e(J,{modelValue:k.value,"onUpdate:modelValue":n[7]||(n[7]=S=>k.value=S),density:"compact",flat:"","hide-details":"",placeholder:"搜尋商品","prepend-inner-icon":"mdi-magnify",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(c,{class:"pa-4 d-flex justify-end align-center",cols:"6",lg:"2",md:"3",sm:"4"},{default:t(()=>[e(h,{color:"primary",variant:"outlined",onClick:d},{default:t(()=>[e(N,{left:""},{default:t(()=>n[11]||(n[11]=[U("mdi-refresh")])),_:1,__:[11]}),n[12]||(n[12]=U(" 重設條件 "))]),_:1,__:[12]})]),_:1})]),_:1}),e(oe)]))}},il=Ce(nl,[["__scopeId","data-v-1b1509ec"]]),rl={class:"position-sticky top-0 bg-surface"},ul={class:"d-flex align-center justify-space-between pa-5"},dl={class:"d-flex align-center text-h6"},cl={class:"d-flex align-center flex-wrap"},ml={key:1,class:"mobile-products"},pl={class:"d-flex justify-space-between align-center"},fl={class:"font-weight-bold text-caption product-id"},vl={class:"font-weight-bold text-h6"},gl={class:"mt-2"},yl={class:"text-caption text-medium-emphasis mt-2"},Vl={__name:"myProduct",setup(i){const f=Fe(),{mobile:V}=ze(),w=K(()=>V.value),C=(d,s)=>d&&d.length>s?d.substring(0,s)+"...":d,F=$([]),x=[{title:"商品ID",key:"_id"},{title:"封面圖",key:"image",sortable:!1},{title:"商品名稱",key:"name"},{title:"類別分類",key:"category"},{title:"情緒分類",key:"emotions"},{title:"情緒價值",key:"price"},{title:"是否上架",key:"sell"},{title:"骰點交易",key:"roll"},{title:"建立日期",key:"createdAt",value:d=>new Date(d.createdAt).toLocaleString()},{title:"更新日期",key:"updatedAt",value:d=>new Date(d.updatedAt).toLocaleString()},{title:"操作",key:"action",sortable:!1}],I=["_id","name","emotions","category","price","description","createdAt","updatedAt"],k=async(d={})=>{try{const s={...d,startDate:d.startDate?d.startDate.toISOString():void 0,endDate:d.endDate?d.endDate.toISOString():void 0},{data:o}=await de.getAll(s);F.value=o.products}catch(s){console.error("Error fetching products:",s),f({text:"無法載入商品資料",snackbarProps:{color:"red"}})}};k();const y=$(!1),E=$(null),M=d=>{E.value=d,y.value=!0},G=()=>{y.value=!1,k()},W=$(""),q=d=>{k(d)},L=()=>{k()};return(d,s)=>(b(),T(se,null,[e(H,{class:"text-text"},{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[p("div",rl,[p("div",ul,[p("div",dl,[e(N,null,{default:t(()=>s[3]||(s[3]=[U("mdi-cards-outline")])),_:1,__:[3]}),s[4]||(s[4]=p("div",{class:"ml-2"},"我的商品",-1))]),p("div",cl,[e(h,{class:"pa-4 d-flex align-center",color:"secondary",variant:"outlined"},{default:t(()=>[e(N,null,{default:t(()=>s[5]||(s[5]=[U("mdi-card-account-details-star-outline")])),_:1,__:[5]}),s[6]||(s[6]=p("div",null,"個人頁面",-1))]),_:1,__:[6]})])]),e(oe)]),e(il,{search:W.value,"onUpdate:search":s[0]||(s[0]=o=>W.value=o),onOpenDialog:s[1]||(s[1]=o=>M(null)),onResetFilters:L,onSearch:q},null,8,["search"]),w.value?(b(),T("div",ml,[(b(!0),T(se,null,ce(F.value,o=>(b(),O(Ie,{key:o._id,class:"mb-1 rounded-0 mobile-products-card"},{default:t(()=>[e($e,null,{default:t(()=>[e(H,{"no-gutters":""},{default:t(()=>[e(c,{cols:"4"},{default:t(()=>[e(Se,{"aspect-ratio":1,class:"rounded-0",cover:"",src:o.image},null,8,["src"])]),_:2},1024),e(c,{class:"pl-4",cols:"8"},{default:t(()=>[p("div",pl,[p("div",fl,"ID: "+B(o._id),1),e(h,{color:"secondary",icon:"mdi-pencil",onClick:n=>M(o)},null,8,["onClick"])]),p("div",vl,B(C(o.name,10)),1),p("div",gl,"分類: "+B(o.category),1),p("div",null,"情緒價值: "+B(o.price),1),p("div",null,[s[7]||(s[7]=U(" 是否上架: ")),e(N,{color:o.sell?"green":"red",icon:o.sell?"mdi-check":"mdi-close"},null,8,["color","icon"])]),p("div",null,[s[8]||(s[8]=U(" 骰點交易: ")),e(N,{color:o.roll?"green":"red",icon:o.roll?"mdi-check":"mdi-close"},null,8,["color","icon"])]),p("div",yl," 更新日期: "+B(new Date(o.updatedAt).toLocaleString()),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])):(b(),O(Ke,{key:0,"filter-keys":I,headers:x,items:F.value,"no-data-text":"查無商品",search:W.value},{"item.image":t(({value:o})=>[e(Se,{"aspect-ratio":1,class:"ma-2 rounded-0",cover:"",src:o,width:"75"},null,8,["src"])]),"item.name":t(({value:o})=>[e(We,{location:"bottom",text:o},{activator:t(({props:n})=>[p("span",Be(He(n)),B(o.length>4?o.substring(0,4)+"...":o),17)]),_:2},1032,["text"])]),"item.sell":t(({value:o})=>[o?(b(),O(N,{key:0,color:"green",icon:"mdi-check"})):(b(),O(N,{key:1,color:"red",icon:"mdi-close"}))]),"item.roll":t(({value:o})=>[o?(b(),O(N,{key:0,color:"green",icon:"mdi-check"})):(b(),O(N,{key:1,color:"red",icon:"mdi-close"}))]),"item.action":t(({item:o})=>[e(h,{color:"secondary",icon:"mdi-pencil",onClick:n=>M(o)},null,8,["onClick"])]),_:1},8,["items","search"]))]),_:1})]),_:1}),e(al,{modelValue:y.value,"onUpdate:modelValue":s[2]||(s[2]=o=>y.value=o),product:E.value,onSubmitSuccess:G},null,8,["modelValue","product"])],64))}},$l=Ce(Vl,[["__scopeId","data-v-9e86c1f1"]]);export{$l as default};
