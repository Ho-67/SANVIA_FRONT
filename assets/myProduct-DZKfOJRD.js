import{bf as Xe,bg as Je,h as X,N as Re,g as T,bh as oe,Q as N,O as Ke,P as pe,bi as Ie,bj as Qe,S as $,q as ve,w as ee,p as R,o as D,t as i,v as e,X as Ye,Y as Ze,x as p,C as Oe,U as et,G as P,D as G,W as Me,V as H,y as h,Z as z,b as E,c as q,a as Ue,E as O,aI as re,F as ue,e as ge,n as Le,$ as tt,aT as at,_ as We,H as j,bk as Ce,ac as Pe,k as lt,A as it,B as st,am as Ae}from"./index-UV5Uae5u.js";import{V as de}from"./VSelect-alX7F2Qf.js";import{V as nt}from"./VTextarea-CkceOX1y.js";import{V as Te}from"./VCheckbox-9ACNxAx8.js";import{V as Se,a as ot}from"./VDatePicker-BAqx7Afo.js";import{V as dt}from"./VTooltip-DL7S9yOD.js";import"./VCheckboxBtn-CT3Jqn2e.js";import"./VChip-5zDcMaYt.js";import"./VPagination-DfqtU8NO.js";import"./VTable-CawCg429.js";/*!
 * FilePondPluginMediaPreview 1.0.11
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit undefined for details.
 */const ye=n=>/^video/.test(n.type),te=n=>/^audio/.test(n.type);class rt{constructor(t,f){this.mediaEl=t,this.audioElems=f,this.onplayhead=!1,this.duration=0,this.timelineWidth=this.audioElems.timeline.offsetWidth-this.audioElems.playhead.offsetWidth,this.moveplayheadFn=this.moveplayhead.bind(this),this.registerListeners()}registerListeners(){this.mediaEl.addEventListener("timeupdate",this.timeUpdate.bind(this),!1),this.mediaEl.addEventListener("canplaythrough",()=>this.duration=this.mediaEl.duration,!1),this.audioElems.timeline.addEventListener("click",this.timelineClicked.bind(this),!1),this.audioElems.button.addEventListener("click",this.play.bind(this)),this.audioElems.playhead.addEventListener("mousedown",this.mouseDown.bind(this),!1),window.addEventListener("mouseup",this.mouseUp.bind(this),!1)}play(){this.mediaEl.paused?this.mediaEl.play():this.mediaEl.pause(),this.audioElems.button.classList.toggle("play"),this.audioElems.button.classList.toggle("pause")}timeUpdate(){let t=this.mediaEl.currentTime/this.duration*100;this.audioElems.playhead.style.marginLeft=t+"%",this.mediaEl.currentTime===this.duration&&(this.audioElems.button.classList.toggle("play"),this.audioElems.button.classList.toggle("pause"))}moveplayhead(t){let f=t.clientX-this.getPosition(this.audioElems.timeline);f>=0&&f<=this.timelineWidth&&(this.audioElems.playhead.style.marginLeft=f+"px"),f<0&&(this.audioElems.playhead.style.marginLeft="0px"),f>this.timelineWidth&&(this.audioElems.playhead.style.marginLeft=this.timelineWidth-4+"px")}timelineClicked(t){this.moveplayhead(t),this.mediaEl.currentTime=this.duration*this.clickPercent(t)}mouseDown(){this.onplayhead=!0,window.addEventListener("mousemove",this.moveplayheadFn,!0),this.mediaEl.removeEventListener("timeupdate",this.timeUpdate.bind(this),!1)}mouseUp(t){window.removeEventListener("mousemove",this.moveplayheadFn,!0),this.onplayhead==!0&&(this.moveplayhead(t),this.mediaEl.currentTime=this.duration*this.clickPercent(t),this.mediaEl.addEventListener("timeupdate",this.timeUpdate.bind(this),!1)),this.onplayhead=!1}clickPercent(t){return(t.clientX-this.getPosition(this.audioElems.timeline))/this.timelineWidth}getPosition(t){return t.getBoundingClientRect().left}}const ut=n=>n.utils.createView({name:"media-preview",tag:"div",ignoreRect:!0,create:({root:t,props:f})=>{const{id:v}=f,r=t.query("GET_ITEM",{id:f.id});let k=te(r.file)?"audio":"video";if(t.ref.media=document.createElement(k),t.ref.media.setAttribute("controls",!0),t.element.appendChild(t.ref.media),te(r.file)){let b=document.createDocumentFragment();t.ref.audio=[],t.ref.audio.container=document.createElement("div"),t.ref.audio.button=document.createElement("span"),t.ref.audio.timeline=document.createElement("div"),t.ref.audio.playhead=document.createElement("div"),t.ref.audio.container.className="audioplayer",t.ref.audio.button.className="playpausebtn play",t.ref.audio.timeline.className="timeline",t.ref.audio.playhead.className="playhead",t.ref.audio.timeline.appendChild(t.ref.audio.playhead),t.ref.audio.container.appendChild(t.ref.audio.button),t.ref.audio.container.appendChild(t.ref.audio.timeline),b.appendChild(t.ref.audio.container),t.element.appendChild(b)}},write:n.utils.createRoute({DID_MEDIA_PREVIEW_LOAD:({root:t,props:f})=>{const{id:v}=f,r=t.query("GET_ITEM",{id:f.id});if(!r)return;let k=window.URL||window.webkitURL,b=new Blob([r.file],{type:r.file.type});t.ref.media.type=r.file.type,t.ref.media.src=r.file.mock&&r.file.url||k.createObjectURL(b),te(r.file)&&new rt(t.ref.media,t.ref.audio),t.ref.media.addEventListener("loadeddata",()=>{let V=75;if(ye(r.file)){let _=t.ref.media.offsetWidth,U=t.ref.media.videoWidth/_;V=t.ref.media.videoHeight/U}t.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:f.id,height:V})},!1)}})}),ct=n=>{const t=({root:v,props:r})=>{const{id:k}=r;v.query("GET_ITEM",k)&&v.dispatch("DID_MEDIA_PREVIEW_LOAD",{id:k})},f=({root:v,props:r})=>{const k=ut(n);v.ref.media=v.appendChildView(v.createChildView(k,{id:r.id}))};return n.utils.createView({name:"media-preview-wrapper",create:f,write:n.utils.createRoute({DID_MEDIA_PREVIEW_CONTAINER_CREATE:t})})},Ne=n=>{const{addFilter:t,utils:f}=n,{Type:v,createRoute:r}=f,k=ct(n);return t("CREATE_VIEW",b=>{const{is:V,view:_,query:U}=b;if(!V("file"))return;const x=({root:g,props:M})=>{const{id:A}=M,C=U("GET_ITEM",A),W=U("GET_ALLOW_VIDEO_PREVIEW"),y=U("GET_ALLOW_AUDIO_PREVIEW");!C||C.archived||(!ye(C.file)||!W)&&(!te(C.file)||!y)||(g.ref.mediaPreview=_.appendChildView(_.createChildView(k,{id:A})),g.dispatch("DID_MEDIA_PREVIEW_CONTAINER_CREATE",{id:A}))};_.registerWriter(r({DID_LOAD_ITEM:x},({root:g,props:M})=>{const{id:A}=M,C=U("GET_ITEM",A),W=g.query("GET_ALLOW_VIDEO_PREVIEW"),y=g.query("GET_ALLOW_AUDIO_PREVIEW");!C||(!ye(C.file)||!W)&&(!te(C.file)||!y)||g.rect.element.hidden}))}),{options:{allowVideoPreview:[!0,v.BOOLEAN],allowAudioPreview:[!0,v.BOOLEAN]}}},mt=typeof window<"u"&&typeof window.document<"u";mt&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:Ne}));const L=[];for(let n=0;n<256;++n)L.push((n+256).toString(16).slice(1));function pt(n,t=0){return(L[n[t+0]]+L[n[t+1]]+L[n[t+2]]+L[n[t+3]]+"-"+L[n[t+4]]+L[n[t+5]]+"-"+L[n[t+6]]+L[n[t+7]]+"-"+L[n[t+8]]+L[n[t+9]]+"-"+L[n[t+10]]+L[n[t+11]]+L[n[t+12]]+L[n[t+13]]+L[n[t+14]]+L[n[t+15]]).toLowerCase()}let fe;const ft=new Uint8Array(16);function vt(){if(!fe){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");fe=crypto.getRandomValues.bind(crypto)}return fe(ft)}const gt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Fe={randomUUID:gt};function $e(n,t,f){var r;if(Fe.randomUUID&&!n)return Fe.randomUUID();n=n||{};const v=n.random??((r=n.rng)==null?void 0:r.call(n))??vt();if(v.length<16)throw new Error("Random bytes length must be >= 16");return v[6]=v[6]&15|64,v[8]=v[8]&63|128,pt(v)}const yt={class:"d-flex align-center"},ht={key:0,class:"text-accent text-error ml-2"},bt={class:"d-flex align-center"},Vt={key:0,class:"text-accent text-error ml-2"},wt={__name:"productAddDialog",props:{modelValue:{type:Boolean,required:!0},product:{type:Object,default:null}},emits:["update:modelValue","submitSuccess"],setup(n,{emit:t}){const f=Xe(Je,Ne),v={load:(d,l,a,s,m)=>{const w=new XMLHttpRequest;return w.open("GET",d),w.responseType="blob",w.addEventListener("load",()=>{if(w.status>=200&&w.status<300){const S=w.getResponseHeader("Content-Type"),Y=new Blob([w.response],{type:S});l(Y)}else a("載入失敗")}),w.addEventListener("error",()=>a("載入錯誤")),w.addEventListener("progress",S=>{S.lengthComputable&&s(!0,S.loaded,S.total)}),w.withCredentials=!1,w.send(),{abort:()=>{w.abort(),m()}}},process:(d,l,a,s,m,w,S)=>{w(!0,0,1),s()}},r=n,k=t,b=X({get:()=>r.modelValue,set:d=>k("update:modelValue",d)}),V=X(()=>!!r.product),_=Re(),U=T(null),x=T([]),g=T({}),M=["正面","中立","負面","其他"],A=["文字","圖片","音樂","語音","影片","物品","其他"],C=oe().of(N()).min(1,"內容不可為空").required("內容不可為空"),{handleSubmit:W,resetForm:y,isSubmitting:c}=Ke({validationSchema:pe({name:N().required("商品名稱必填").max(50,"商品名稱最多50個字"),price:Qe().typeError("情緒價值必填").required("情緒價值必填").min(0,"情緒價值不得為負數"),emotions:N().required("情緒分類必填").oneOf(M,"請選擇有效的分類"),category:N().required("商品類別必填").oneOf(A,"請選擇有效的分類"),details:N().max(20,"細項說明最多20字"),description:N().required("商品簡介必填").max(200,"商品簡介最多200字"),images:oe().min(1,"至少需要一張商品圖片").max(5,"最多只能上傳5張圖片").required("至少需要一張商品圖片"),features:oe().of(pe({type:N().oneOf(["文字說明","圖片說明","影音說明"]),content:C,tempId:N()})),specifications:oe().of(pe({type:N().oneOf(["文字說明","圖片說明"]),content:C,tempId:N()})),sell:Ie().required(),roll:Ie().required()}),initialValues:{name:"",price:0,emotions:"",category:"",details:"",description:"",sell:!1,features:[],specifications:[],roll:!1,images:[]}}),o=$("name"),u=$("price"),I=$("emotions"),B=$("category"),ae=$("details"),le=$("description"),K=$("features"),Q=$("specifications"),ie=$("sell"),se=$("roll"),je=$("images"),he=()=>{b.value=!1},qe=d=>{x.value=d,je.value.value=d},be=X(()=>(K.value.value||[]).length>=10),Ve=X(()=>(Q.value.value||[]).length>=5),we=d=>{const l=d==="features"?K.value.value:Q.value.value,a=d==="features"?10:5;if(l.length>=a){_({text:`最多只能新增 ${a} 個`,snackbarProps:{color:"red"}});return}l.push({type:"文字說明",content:[""],tempId:$e()})},Ee=(d,l)=>{const a=d==="features"?K.value.value:Q.value.value,s=a[l];if(s&&s.tempId){const m=`${d}${s.tempId}`;g.value[m]&&delete g.value[m]}a.splice(l,1)},_e=d=>{const l=`feature${d.tempId}`,a=`spec${d.tempId}`;g.value[l]&&delete g.value[l],g.value[a]&&delete g.value[a],d.content=d.type==="文字說明"?[""]:[]},ke=(d,l,a)=>{const s=`${l}${d.tempId}`;g.value[s]=a,d.content=a.map(m=>m.file instanceof File?"__HAS_FILE__":typeof m.source=="string"?m.source:"").filter(Boolean)},Be=W(async d=>{var l,a;if(!V.value&&x.value.length===0){_({text:"請至少上傳一張商品圖片",snackbarProps:{color:"red"}});return}for(const s of[...d.features,...d.specifications]){if(!s.content||s.content.length===0){_({text:"內容不能為空",snackbarProps:{color:"red"}});return}if(s.type==="文字說明"&&s.content[0].trim()===""){_({text:"文字說明內容不能為空",snackbarProps:{color:"red"}});return}}try{const s=new FormData;if(s.append("emotions",d.emotions),s.append("category",d.category),s.append("details",d.details),s.append("name",d.name),s.append("price",d.price),s.append("description",d.description),s.append("sell",d.sell),s.append("roll",d.roll),V.value){const F=x.value.filter(J=>typeof J.source=="string"&&!(J.file instanceof File)).map(J=>J.source);s.append("existingImages",JSON.stringify(F))}const m=x.value.filter(F=>F.file instanceof File);for(const F of m)s.append("images",F.file);const w=[],S=(F,J)=>F.map(Z=>{if(Z.type==="文字說明")return{type:Z.type,content:Z.content};const He=`${J}${Z.tempId}`,ze=g.value[He]||[],me=[];for(const ne of ze)ne.file instanceof File?(w.push(ne.file),me.push("__HAS_FILE__")):typeof ne.source=="string"&&me.push(ne.source);return{type:Z.type,content:me}}),Y=S(d.features,"feature"),ce=S(d.specifications,"spec");for(const F of w)s.append("dynamicMedia",F);s.append("features",JSON.stringify(Y)),s.append("specifications",JSON.stringify(ce)),await(V.value?ve.update(r.product._id,s):ve.create(s)),_({text:"操作成功！",snackbarProps:{color:"green"}}),he(),k("submitSuccess")}catch(s){console.error("Error submitting form:",s),_({text:((a=(l=s.response)==null?void 0:l.data)==null?void 0:a.message)||"操作失敗，請稍後再試",snackbarProps:{color:"red"}})}}),Ge=d=>{const l=d.split(".").pop().toLowerCase().split("?")[0];return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",mp3:"audio/mpeg",wav:"audio/wav",mp4:"video/mp4"}[l]||"application/octet-stream"},De=d=>{const l=d.startsWith("http")?d:`${baseURL}/${d.replace(/^\/+/,"")}`,a=Ge(l),s=a.startsWith("video/"),m=a.startsWith("audio/");return a.startsWith("image/"),{source:l,options:{type:"local",file:null,metadata:{poster:l,mediaType:s?"video":m?"audio":"image"}}}},xe=(d,l)=>{const a=[],s={};if(!d)return{items:a,files:s};const m=Array.isArray(d)?d.map(w=>({...w})):[];for(const w of m){const S=$e(),Y=`${l}${S}`;if(w.type!=="文字說明"&&Array.isArray(w.content)){const ce=[...w.content];s[Y]=ce.map(F=>F==="__HAS_FILE__"?null:De(F)).filter(Boolean)}a.push({...w,tempId:S})}return{items:a,files:s}};return ee(()=>b.value,d=>{var l;if(d)if(V.value){o.value.value=r.product.name,u.value.value=r.product.price,I.value.value=r.product.emotions,B.value.value=r.product.category,ae.value.value=r.product.details,le.value.value=r.product.description,ie.value.value=r.product.sell,se.value.value=r.product.roll||!1;const a={},s=xe(r.product.features,"feature");K.value.value=s.items,Object.assign(a,s.files);const m=xe(r.product.specifications,"spec");Q.value.value=m.items,Object.assign(a,m.files),g.value=a,x.value=((l=r.product.images)==null?void 0:l.map(De))||[]}else y(),x.value=[],g.value={}},{immediate:!0}),(d,l)=>(D(),R(at,{modelValue:b.value,"onUpdate:modelValue":l[11]||(l[11]=a=>b.value=a),fullscreen:"",transition:"dialog-bottom-transition"},{default:i(()=>[e(Ye,{class:"h-100",disabled:p(c),onSubmit:Ze(p(Be),["prevent"])},{default:i(()=>[e(Oe,null,{default:i(()=>[e(et,{class:"text-accent px-6 mt-4"},{default:i(()=>[P(G(V.value?"編輯商品":"新增商品"),1)]),_:1}),e(Me,null,{default:i(()=>[e(H,{"no-gutters":""},{default:i(()=>[e(h,{cols:"12",md:"6"},{default:i(()=>[e(z,{modelValue:p(o).value.value,"onUpdate:modelValue":l[0]||(l[0]=a=>p(o).value.value=a),class:"mb-4 pr-md-1","error-messages":p(o).errorMessage.value,label:"商品名稱",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(h,{cols:"12",md:"6"},{default:i(()=>[e(z,{modelValue:p(u).value.value,"onUpdate:modelValue":l[1]||(l[1]=a=>p(u).value.value=a),modelModifiers:{number:!0},class:"mb-4 pl-md-1","error-messages":p(u).errorMessage.value,label:"情緒價值",min:"0",type:"number",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(h,{cols:"12",md:"4"},{default:i(()=>[e(de,{modelValue:p(I).value.value,"onUpdate:modelValue":l[2]||(l[2]=a=>p(I).value.value=a),class:"mb-4 pr-md-1","error-messages":p(I).errorMessage.value,items:M,label:"情緒分類",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(h,{cols:"12",md:"4"},{default:i(()=>[e(de,{modelValue:p(B).value.value,"onUpdate:modelValue":l[3]||(l[3]=a=>p(B).value.value=a),class:"mb-4 px-md-1","error-messages":p(B).errorMessage.value,items:A,label:"商品類別",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(h,{cols:"12",md:"4"},{default:i(()=>[e(z,{modelValue:p(ae).value.value,"onUpdate:modelValue":l[4]||(l[4]=a=>p(ae).value.value=a),class:"mb-4 pl-md-1","error-messages":p(ae).errorMessage.value,label:"細項說明(選填)",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(h,{class:"my-4",cols:"12"},{default:i(()=>[e(H,null,{default:i(()=>[e(h,{cols:"12",sm:"auto"},{default:i(()=>l[12]||(l[12]=[E("span",{class:"text-body-1 text-nav mb-0"},"上傳商品圖",-1),E("br",null,null,-1),E("span",{class:"text-body-2 text-nav mb-0"},"（最多5張）",-1)])),_:1,__:[12]}),e(h,null,{default:i(()=>[e(p(f),{ref_key:"fileAgent",ref:U,modelValue:x.value,"onUpdate:modelValue":l[5]||(l[5]=a=>x.value=a),"accepted-file-types":"image/jpeg, image/png, image/gif","allow-image-preview":!0,"allow-multiple":!0,"allow-remove":!0,credits:"",files:x.value,"image-preview-height":200,"label-idle":"拖曳或點選 上傳圖片（第一張為封面圖）","label-max-file-size":"最大允許大小：{filesize}","max-file-size":"1MB","max-files":5,server:v,onUpdatefiles:qe},null,8,["modelValue","files"])]),_:1})]),_:1})]),_:1}),e(h,{class:"mt-4",cols:"12"},{default:i(()=>[e(nt,{modelValue:p(le).value.value,"onUpdate:modelValue":l[6]||(l[6]=a=>p(le).value.value=a),class:"mb-4","error-messages":p(le).errorMessage.value,label:"商品描述(簡介)",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(h,{class:"my-4",cols:"12"},{default:i(()=>[E("div",yt,[l[14]||(l[14]=E("span",{class:"text-body-1 text-nav mb-0"},"商品特色(主要內容)",-1)),e(O,{class:"ml-auto",color:"primary",density:"compact",disabled:be.value,variant:"outlined",onClick:l[7]||(l[7]=a=>we("features"))},{default:i(()=>l[13]||(l[13]=[P(" 新增特色 ")])),_:1,__:[13]},8,["disabled"]),be.value?(D(),q("p",ht,"最多新增 10 個")):Ue("",!0)]),e(re,{class:"my-2"}),(D(!0),q(ue,null,ge(p(K).value.value,(a,s)=>(D(),q("div",{key:a.tempId},[e(H,{class:"mt-2","no-gutters":""},{default:i(()=>[e(h,{cols:"12",md:"4"},{default:i(()=>[e(de,{modelValue:a.type,"onUpdate:modelValue":[m=>a.type=m,m=>_e(a)],density:"compact","hide-details":"",items:["文字說明","圖片說明","影音說明"],label:"內容類型",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(h,{cols:"12",md:"8"},{default:i(()=>[a.type==="文字說明"?(D(),R(z,{key:0,modelValue:a.content[0],"onUpdate:modelValue":m=>a.content[0]=m,class:"pl-md-2",density:"compact","hide-details":"",label:"內容 "+(s+1),variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","label"])):(D(),R(p(f),{key:1,id:"featurePond"+s,ref_for:!0,ref:"featurePond"+s,"accepted-file-types":a.type==="圖片說明"?"image/jpeg, image/png, image/gif":"audio/mpeg, audio/wav, video/mp4","allow-audio-preview":!0,"allow-image-preview":!0,"allow-media-preview":!0,"allow-multiple":!0,"allow-remove":!0,"allow-video-preview":!0,class:Le("pl-md-2"),credits:"",files:g.value["feature"+a.tempId],"image-preview-height":200,"label-idle":"拖曳或點選 上傳 "+(a.type==="圖片說明"?"圖片說明":"影音說明"),"max-file-size":"20MB","max-files":10,server:v,onUpdatefiles:m=>ke(a,"feature",m)},null,8,["id","accepted-file-types","files","label-idle","onUpdatefiles"]))]),_:2},1024),e(h,{class:"d-flex justify-end mt-2",cols:"12"},{default:i(()=>[e(O,{color:"red",density:"compact",variant:"text",onClick:m=>Ee("features",s)},{default:i(()=>l[15]||(l[15]=[P(" 刪除 ")])),_:2,__:[15]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),_:1}),e(h,{class:"my-4",cols:"12"},{default:i(()=>[E("div",bt,[l[17]||(l[17]=E("span",{class:"text-body-1 text-nav mb-0"},"商品規格",-1)),e(O,{class:"ml-auto",color:"primary",density:"compact",disabled:Ve.value,variant:"outlined",onClick:l[8]||(l[8]=a=>we("specifications"))},{default:i(()=>l[16]||(l[16]=[P(" 新增規格 ")])),_:1,__:[16]},8,["disabled"]),Ve.value?(D(),q("p",Vt,"最多新增 5 個")):Ue("",!0)]),e(re,{class:"my-2"}),(D(!0),q(ue,null,ge(p(Q).value.value,(a,s)=>(D(),q("div",{key:a.tempId},[e(H,{class:"mt-2","no-gutters":""},{default:i(()=>[e(h,{cols:"12",md:"4"},{default:i(()=>[e(de,{modelValue:a.type,"onUpdate:modelValue":[m=>a.type=m,m=>_e(a)],density:"compact","hide-details":"",items:["文字說明","圖片說明"],label:"內容類型",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(h,{cols:"12",md:"8"},{default:i(()=>[a.type==="文字說明"?(D(),R(z,{key:0,modelValue:a.content[0],"onUpdate:modelValue":m=>a.content[0]=m,class:"pl-md-2",density:"compact","hide-details":"",label:"內容 "+(s+1),variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","label"])):(D(),R(p(f),{key:1,id:"specPond"+s,ref_for:!0,ref:"specPond"+s,"accepted-file-types":"image/jpeg, image/png, image/gif","allow-image-preview":!0,"allow-multiple":!0,"allow-remove":!0,class:Le("pl-md-2"),credits:"",files:g.value["spec"+a.tempId],"image-preview-height":200,"label-idle":"拖曳或點選 上傳 圖片","max-file-size":"20MB","max-files":5,server:v,onUpdatefiles:m=>ke(a,"spec",m)},null,8,["id","files","onUpdatefiles"]))]),_:2},1024),e(h,{class:"d-flex justify-end mt-2",cols:"12"},{default:i(()=>[e(O,{color:"red",density:"compact",variant:"text",onClick:m=>Ee("specifications",s)},{default:i(()=>l[18]||(l[18]=[P(" 刪除 ")])),_:2,__:[18]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1})]),_:1}),e(tt,null,{default:i(()=>[e(H,{class:"px-3","no-gutters":""},{default:i(()=>[e(h,{class:"d-flex no-wrap",cols:"12",sm:"6"},{default:i(()=>[e(Te,{modelValue:p(ie).value.value,"onUpdate:modelValue":l[9]||(l[9]=a=>p(ie).value.value=a),"error-messages":p(ie).errorMessage.value,"hide-details":"",label:"上架"},null,8,["modelValue","error-messages"]),e(Te,{modelValue:p(se).value.value,"onUpdate:modelValue":l[10]||(l[10]=a=>p(se).value.value=a),"error-messages":p(se).errorMessage.value,"hide-details":"",label:"開放骰點交易"},null,8,["modelValue","error-messages"])]),_:1}),e(h,{class:"d-flex justify-end pt-1",cols:"12",sm:"6"},{default:i(()=>[e(O,{class:"text-primary",disabled:p(c),onClick:he},{default:i(()=>l[19]||(l[19]=[P(" 取消 ")])),_:1,__:[19]},8,["disabled"]),e(O,{class:"text-accent",loading:p(c),type:"submit",variant:"flat"},{default:i(()=>[P(G(V.value?"編輯":"新增"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]))}},Et={class:"sticky-top"},_t={class:"d-flex align-center"},kt={__name:"productTop",props:{search:{type:String,default:""}},emits:["update:search","openDialog","resetFilters","search"],setup(n,{emit:t}){const f=n,v=t,r=T(!1),k=T(!1),b=T(null),V=T(null),_=T(f.search),U=T(null),x=T(null);ee(b,o=>{U.value=o},{immediate:!0}),ee(V,o=>{x.value=o},{immediate:!0});const g=X(()=>b.value&&V.value&&new Date(b.value)>new Date(V.value)?["開始日期不能晚於結束日期"]:[]),M=o=>{b.value=o,r.value=!1,c()},A=o=>{V.value=o,k.value=!1,c()};ee(()=>_.value,()=>c()),ee(()=>[b.value,V.value],()=>c());const C=X(()=>b.value?new Date(b.value).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):""),W=X(()=>V.value?new Date(V.value).toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}):""),y=()=>{b.value=null,V.value=null,_.value="",v("resetFilters")},c=()=>{g.value.length>0||v("search",{search:_.value,startDate:b.value?new Date(b.value):null,endDate:V.value?new Date(V.value):null})};return(o,u)=>(D(),q("div",Et,[e(H,{"no-gutters":""},{default:i(()=>[e(h,{class:"pa-4",cols:"12",lg:"2",md:"3"},{default:i(()=>[e(O,{block:"",color:"primary",variant:"outlined",onClick:u[0]||(u[0]=I=>o.$emit("openDialog",null))},{default:i(()=>[e(j,{left:""},{default:i(()=>u[8]||(u[8]=[P("mdi-plus")])),_:1,__:[8]}),u[9]||(u[9]=P(" 新增商品 "))]),_:1,__:[9]})]),_:1}),e(h,{class:"pa-4",cols:"12",lg:"5",md:"9"},{default:i(()=>[E("div",_t,[e(Ce,{modelValue:r.value,"onUpdate:modelValue":u[3]||(u[3]=I=>r.value=I),"close-on-content-click":!1,location:"bottom left",transition:"scale-transition"},{activator:i(({props:I})=>[e(z,Pe({modelValue:C.value,"onUpdate:modelValue":u[1]||(u[1]=B=>C.value=B),density:"compact"},I,{"error-messages":g.value,"hide-details":"",label:"開始日期","prepend-inner-icon":"mdi-calendar",readonly:"",variant:"outlined"}),null,16,["modelValue","error-messages"])]),default:i(()=>[e(Se,{modelValue:U.value,"onUpdate:modelValue":[u[2]||(u[2]=I=>U.value=I),M],"first-day-of-week":1,max:x.value},null,8,["modelValue","max"])]),_:1},8,["modelValue"]),u[10]||(u[10]=E("span",{class:"mx-2"},"~",-1)),e(Ce,{modelValue:k.value,"onUpdate:modelValue":u[6]||(u[6]=I=>k.value=I),"close-on-content-click":!1,location:"bottom left",transition:"scale-transition"},{activator:i(({props:I})=>[e(z,Pe({modelValue:W.value,"onUpdate:modelValue":u[4]||(u[4]=B=>W.value=B),density:"compact"},I,{"error-messages":g.value,"hide-details":"",label:"結束日期","prepend-inner-icon":"mdi-calendar",readonly:"",variant:"outlined"}),null,16,["modelValue","error-messages"])]),default:i(()=>[e(Se,{modelValue:x.value,"onUpdate:modelValue":[u[5]||(u[5]=I=>x.value=I),A],"first-day-of-week":1,min:U.value},null,8,["modelValue","min"])]),_:1},8,["modelValue"])])]),_:1}),e(h,{class:"pa-4",cols:"6",lg:"3",md:"9",sm:"8"},{default:i(()=>[e(z,{modelValue:_.value,"onUpdate:modelValue":u[7]||(u[7]=I=>_.value=I),density:"compact",flat:"","hide-details":"",placeholder:"搜尋商品","prepend-inner-icon":"mdi-magnify",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(h,{class:"pa-4 d-flex justify-end align-center",cols:"6",lg:"2",md:"3",sm:"4"},{default:i(()=>[e(O,{color:"primary",variant:"outlined",onClick:y},{default:i(()=>[e(j,{left:""},{default:i(()=>u[11]||(u[11]=[P("mdi-refresh")])),_:1,__:[11]}),u[12]||(u[12]=P(" 重設條件 "))]),_:1,__:[12]})]),_:1})]),_:1}),e(re)]))}},Dt=We(kt,[["__scopeId","data-v-1b1509ec"]]),xt={class:"position-sticky top-0 bg-surface"},It={class:"d-flex align-center justify-space-between pa-5"},Ut={class:"d-flex align-center text-h6"},Lt={class:"d-flex align-center flex-wrap"},Ct={key:1,class:"mobile-products"},Pt={class:"d-flex justify-space-between align-center"},At={class:"font-weight-bold text-caption product-id"},Tt={class:"font-weight-bold text-h6"},St={class:"mt-2"},Ft={class:"text-caption text-medium-emphasis mt-2"},$t={__name:"myProduct",setup(n){const t=Re(),{mobile:f}=lt(),v=X(()=>f.value),r=(y,c)=>y&&y.length>c?y.substring(0,c)+"...":y,k=T([]),b=[{title:"商品ID",key:"_id"},{title:"封面圖",key:"image",sortable:!1},{title:"商品名稱",key:"name"},{title:"類別分類",key:"category"},{title:"情緒分類",key:"emotions"},{title:"情緒價值",key:"price"},{title:"是否上架",key:"sell"},{title:"骰點交易",key:"roll"},{title:"建立日期",key:"createdAt",value:y=>new Date(y.createdAt).toLocaleString()},{title:"更新日期",key:"updatedAt",value:y=>new Date(y.updatedAt).toLocaleString()},{title:"操作",key:"action",sortable:!1}],V=["_id","name","emotions","category","price","description","createdAt","updatedAt"],_=async(y={})=>{try{const c={...y,startDate:y.startDate?y.startDate.toISOString():void 0,endDate:y.endDate?y.endDate.toISOString():void 0},{data:o}=await ve.getAll(c);k.value=o.products}catch(c){console.error("Error fetching products:",c),t({text:"無法載入商品資料",snackbarProps:{color:"red"}})}};_();const U=T(!1),x=T(null),g=y=>{x.value=y,U.value=!0},M=()=>{U.value=!1,_()},A=T(""),C=y=>{_(y)},W=()=>{_()};return(y,c)=>(D(),q(ue,null,[e(H,{class:"text-text"},{default:i(()=>[e(h,{cols:"12"},{default:i(()=>[E("div",xt,[E("div",It,[E("div",Ut,[e(j,null,{default:i(()=>c[3]||(c[3]=[P("mdi-cards-outline")])),_:1,__:[3]}),c[4]||(c[4]=E("div",{class:"ml-2"},"我的商品",-1))]),E("div",Lt,[e(O,{class:"pa-4 d-flex align-center",color:"secondary",variant:"outlined"},{default:i(()=>[e(j,null,{default:i(()=>c[5]||(c[5]=[P("mdi-card-account-details-star-outline")])),_:1,__:[5]}),c[6]||(c[6]=E("div",null,"個人頁面",-1))]),_:1,__:[6]})])]),e(re)]),e(Dt,{search:A.value,"onUpdate:search":c[0]||(c[0]=o=>A.value=o),onOpenDialog:c[1]||(c[1]=o=>g(null)),onResetFilters:W,onSearch:C},null,8,["search"]),v.value?(D(),q("div",Ct,[(D(!0),q(ue,null,ge(k.value,o=>(D(),R(Oe,{key:o._id,class:"mb-1 rounded-0 mobile-products-card"},{default:i(()=>[e(Me,null,{default:i(()=>[e(H,{"no-gutters":""},{default:i(()=>[e(h,{cols:"4"},{default:i(()=>[e(Ae,{"aspect-ratio":1,class:"rounded-0",cover:"",src:o.image},null,8,["src"])]),_:2},1024),e(h,{class:"pl-4",cols:"8"},{default:i(()=>[E("div",Pt,[E("div",At,"ID: "+G(o._id),1),e(O,{color:"secondary",icon:"mdi-pencil",onClick:u=>g(o)},null,8,["onClick"])]),E("div",Tt,G(r(o.name,10)),1),E("div",St,"分類: "+G(o.category),1),E("div",null,"情緒價值: "+G(o.price),1),E("div",null,[c[7]||(c[7]=P(" 是否上架: ")),e(j,{color:o.sell?"green":"red",icon:o.sell?"mdi-check":"mdi-close"},null,8,["color","icon"])]),E("div",null,[c[8]||(c[8]=P(" 骰點交易: ")),e(j,{color:o.roll?"green":"red",icon:o.roll?"mdi-check":"mdi-close"},null,8,["color","icon"])]),E("div",Ft," 更新日期: "+G(new Date(o.updatedAt).toLocaleString()),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])):(D(),R(ot,{key:0,"filter-keys":V,headers:b,items:k.value,"no-data-text":"查無商品",search:A.value},{"item.image":i(({value:o})=>[e(Ae,{"aspect-ratio":1,class:"ma-2 rounded-0",cover:"",src:o,width:"75"},null,8,["src"])]),"item.name":i(({value:o})=>[e(dt,{location:"bottom",text:o},{activator:i(({props:u})=>[E("span",it(st(u)),G(o.length>4?o.substring(0,4)+"...":o),17)]),_:2},1032,["text"])]),"item.sell":i(({value:o})=>[o?(D(),R(j,{key:0,color:"green",icon:"mdi-check"})):(D(),R(j,{key:1,color:"red",icon:"mdi-close"}))]),"item.roll":i(({value:o})=>[o?(D(),R(j,{key:0,color:"green",icon:"mdi-check"})):(D(),R(j,{key:1,color:"red",icon:"mdi-close"}))]),"item.action":i(({item:o})=>[e(O,{color:"secondary",icon:"mdi-pencil",onClick:u=>g(o)},null,8,["onClick"])]),_:1},8,["items","search"]))]),_:1})]),_:1}),e(wt,{modelValue:U.value,"onUpdate:modelValue":c[2]||(c[2]=o=>U.value=o),product:x.value,onSubmitSuccess:M},null,8,["modelValue","product"])],64))}},zt=We($t,[["__scopeId","data-v-9e86c1f1"]]);export{zt as default};
